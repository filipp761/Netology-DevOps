# Домашнее задание к занятию 13 «Введение в мониторинг»

## Обязательные задания

1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчётов, которые сохраняются на диск. 
Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?

2. Менеджер продукта, посмотрев на ваши метрики, сказал, что ему непонятно, что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

3. Вашей DevOps-команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики, в свою очередь, хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

4. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA = 99% по http-кодам ответов. 
Этот параметр вычисляется по формуле: summ_2xx_requests/summ_all_requests. Он не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

### Ответ:

1. Мониторить необходимо не все подряд, а только то что нужно. В данном случае необходимо как минимум мониторить:

  * Для CPU нужно определить:
    * Задержка: средняя или максимальная задержка в планировщике CPU
    * Трафик: загрузка процессора
    * Ошибки: ошибки конкретного процессора, неисправные процессоры
   
  * Для устройства хранения:
    * Задержка: среднее время ожидания для операций чтения и записи
    * Трафик: чтение и запись уровней ввода/вывода
    * Ошибки: ошибки файловой системы, ошибки диска в /sys/devices
   
  * Приложения, обслуживающие клиентов, отслеживают по таким сигналам:
    * Задержка: время выполнения запросов
    * Трафик: количество запросов в секунду
    * Ошибки: ошибки приложения, возникающие при обработке клиентских запросов или доступе к ресурсам
    * Насыщение: процент или количество ресурсов, используемых в настоящее время
   
  * Метрики RAM

2. Чтобы точно понимать выполнение обязанностей перед клиентами, надо изначально договрится какие показатели важны для клиента, для этого необходимо использовать метрики SLA, SLO и SLI:
    * SLI (Service Level Indicator) — метрики времени (задержка запроса, пропускная способность, число запросов в секунду или число сбоев на запрос). Они, как правило, агрегируются во времени, а затем преобразуются в среднее или процент по отношению к пороговому значению;
    * SLO (Service Level Objective) — целевые показатели совокупного успеха SLI в течение определенного периода времени (месяц, квартал и т.д.), согласованные заинтересованными сторонами.
    * SLA (соглашение об уровне обслуживания) — это соглашение между поставщиком и клиентом об измеримых показателях, таких как время безотказной работы, время реагирования, а также мерах ответственности.
  
3. Самый просто вариант, это просто написать скрипт который будет собирать логи и ошибки и отпрвлять их на общий ресурс. Из бесплатных готовых платформ: Sentry — это платформа для отслеживания ошибок и мониторинга приложений. Данные, которые мы получаем в Sentry, содержат исчерпывающую информацию о контексте, в котором это произошло, что облегчает воспроизведение и поиск причины и значительно помогает в устранении ошибок.

4. Ошибка в формуле расчета доступности, необходимо учитывать не только ответы с кодом 2xx, но и 3xx. Правильная формула расчета досупности (summ_2xx_requests + summ_3xx_requests) / (summ_all_requests)
   
