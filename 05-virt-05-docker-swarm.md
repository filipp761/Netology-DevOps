# Домашнее задание к занятию 5. «Оркестрация кластером Docker контейнеров на примере Docker Swarm»

## Задача 1

Дайте письменые ответы на вопросы:

- В чём отличие режимов работы сервисов в Docker Swarm-кластере: replication и global?
- Какой алгоритм выбора лидера используется в Docker Swarm-кластере?
- Что такое Overlay Network?

---
### Ответ
* **В чём отличие режимов работы сервисов в Docker Swarm-кластере: replication и global?** - Для реплицируемой службы указывается количество идентичных задач, которые необходимо запустить.
Глобальная служба запускает одну задачу на каждом узле. Заранее заданного количества заданий нет. Каждый раз, когда добавляется узел в swarm, оркестратор создает задачу, а планировщик назначает задачу новому узлу. Хорошими кандидатами для глобальных служб являются агенты мониторинга, антивирусные сканеры или другие типы контейнеров, которые требуется запускать на каждом узле в рое
* **Какой алгоритм выбора лидера используется в Docker Swarm-кластере?** - 
Лидер выбирается командой:
```docker swarm init```

Механизм выбора лидера основан на алгоритме raft, который включает в себя 3 принципа выбора лидера:
1) Кандидат получает большинство голосов (включая свой) и побеждает в выборах.
2) Кандидат получает сообщение от уже действующего лидера текущего срока или от любого сервера более старшего срока.
3) Кандидат не получает за некоторый таймаут большинство голосов

* **Что такое Overlay Network?** - Overlay-сеть создает подсеть, которую могут использовать контейнеры в разных хостах swarm-кластера. Контейнеры на разных физических хостах могут обмениваться данными по overlay-сети (если все они прикреплены к одной сети). Overlay-сеть использует технологию vxlan, которая инкапсулирует layer 2 фреймы в layer 4 пакеты (UDP/IP). При помощи этого действия Docker создает виртуальные сети поверх существующих связей между хостами, которые могут оказаться внутри одной подсети. Любые точки, которые являются частью этой виртуальной сети, выглядят друг для друга так, будто они связаны поверх свича и не заботятся об устройстве основной физической сети

## Задача 2

Создайте ваш первый Docker Swarm-кластер в Яндекс Облаке.

Чтобы получить зачёт, предоставьте скриншот из терминала (консоли) с выводом команды:
```
docker node ls
```
![alt text](https://github.com/filipp761/Netology-sdb-homewoks/blob/main/05-virt-05-docker-swarm/docker_node_ls.png)

## Задача 3

Создайте ваш первый, готовый к боевой эксплуатации кластер мониторинга, состоящий из стека микросервисов.

Чтобы получить зачёт, предоставьте скриншот из терминала (консоли), с выводом команды:
```
docker service ls
```
![alt text](https://github.com/filipp761/Netology-sdb-homewoks/blob/main/05-virt-05-docker-swarm/docker_service.png)

## Задача 4 (*)

Выполните на лидере Docker Swarm-кластера команду, указанную ниже, и дайте письменное описание её функционала — что она делает и зачем нужна:
```
# см.документацию: https://docs.docker.com/engine/swarm/swarm_manager_locking/
docker swarm update --autolock=true
```
---
### Ответ
![alt text](https://github.com/filipp761/Netology-sdb-homewoks/blob/main/05-virt-05-docker-swarm/autolock.png)
![alt text](https://github.com/filipp761/Netology-sdb-homewoks/blob/main/05-virt-05-docker-swarm/autolock_2.png)
![alt text](https://github.com/filipp761/Netology-sdb-homewoks/blob/main/05-virt-05-docker-swarm/autolock_3.png)
* Команда ```docker swarm update --autolock=true``` создает новый ключ, используемый для шифрования открытых/закрытых ключей, используемых для шифрования/расшифровки журналов. При перезапуске Docker в память каждого управляющего узла загружается как ключ TLS, используемый для шифрования связи между узлами swarm, так и ключ, используемый для шифрования и расшифровки журналов Raft на диске. Docker может защитить общий ключ шифрования TLS и ключ, используемый для шифрования и расшифровки журналов Raft в состоянии покоя, позволяя вам стать владельцем этих ключей и требовать ручной разблокировки ваших менеджеров. Эта функция называется автоблокировкой.
Когда Docker перезапустится, вы должны сначала разблокировать рой, используя ключ шифрования, сгенерированный Docker, когда рой был заблокирован. Вы можете изменить этот ключ шифрования в любое время.
